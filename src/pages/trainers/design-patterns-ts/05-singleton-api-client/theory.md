---
title: "Паттерн Singleton (Синглтон), практика: одиночный API-client"
---

Как мы уже выяснили, Singleton — это единый «глобальный» объект для хранения чего-то общего для всей системы. В React Singleton может выступать «глобальным» хранилищем какого-то общего для всей системы инстанса библиотеки или сервиса, например, API-клиента.

Представьте, что в приложении есть отдельный модуль `apiClient.ts` с классом `ApiClient`. Этот класс служит обёрткой для удобной работы с сетевой библиотекой `axios`. Внутри конструктора класса инициализируется `axios` и инстанс сохраняется в поле класса `this.client`:

```ts
constructor() {
  this.client = axios.create({
    baseURL: 'https://jsonplaceholder.typicode.com',
    timeout: 5000,
    headers: { 'Content-Type': 'application/json' },
  });
}
```

Также у класса есть метод `get` со строковым параметром `endpoint` (адрес, куда направлять запрос), вызывающий внутри метод API-клиента `this.client.get(endpoint)`:

```ts
get<T = any>(endpoint: string): Promise<AxiosResponse<T>> {
  return this.client.get<T>(endpoint);
}
```

Вам нужно позаботиться о том, чтобы класс мог быть создан только в единственном экземпляре и при попытке многократного создания ссылался на один и тот же изначальный инстанс (реализуется через замыкание переменной `instance`, хранящей созданный экземпляр класса):

```ts
constructor() {
  if (!instance) {
    instance = this;
  }
  return instance;
}
```

Внутри модуля создаётся инстанс `ApiClient` и экспортируется наружу, но этот инстанс сейчас никак не защищён от модификации. Так что вам нужно применить «фриз» и «заморозить» свежесозданный инстанс:

```ts
Object.freeze(new ApiClient());
```
