---
title: "Паттерн Singleton (Синглтон), практика: одиночный API-client на axios"
---

Как мы уже выяснили, Singleton — это единый «глобальный» объект для хранения чего-то общего для всей системы. В React Singleton может выступать «глобальным» хранилищем какого-то общего для всей системы инстанса библиотеки или сервиса, например, API-клиента.

Представьте, что в приложении есть отдельный модуль `apiClient.js` с классом `ApiClient`. Этот класс служит обёрткой для удобной работы с сетевой библиотекой `axios`. Внутри конструктора класса инициализируется `axios` и инстанс сохраняется в поле класса `this.client`:

```js
constructor() {
  this.client = axios.create({
    baseURL: 'https://jsonplaceholder.typicode.com',
    timeout: 5000,
    headers: { 'Content-Type': 'application/json' },
  });
}
```

Также у класса есть метод `get` со строковым параметром `endpoint` (адрес, куда направлять запрос), вызывающий внутри метод API-клиента `this.client.get(endpoint)`:

```js
/**
 * GET-запрос к API
 * @param {string} endpoint - URL endpoint для запроса
 * @returns {Promise<object>} Промис с ответом сервера
 * @throws {AxiosError} Ошибка сетевого взаимодействия или таймаута
 */
get(endpoint) {
  return this.client.get(endpoint);
}
```

Вам нужно позаботиться о том, чтобы класс мог быть создан только в единственном экземпляре и при попытке многократного создания ссылался на один и тот же изначальный инстанс (реализуется через замыкание переменной `instance`, хранящей созданный экземпляр класса):

```js
constructor() {
  if (!instance) {
    instance = this;
  }
  return instance;
}
```

Внутри модуля создаётся инстанс `ApiClient` и экспортируется наружу, но этот инстанс сейчас никак не защищён от модификации. Так что вам нужно применить «фриз» и «заморозить» свежесозданный инстанс:

```js
Object.freeze(new ApiClient());
```
