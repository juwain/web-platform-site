---
import TrainersLayout from "../../../../layouts/TrainersLayout.astro";
import Editor from "../../../../components/Editor.astro";
import Theory from "../../../../components/Theory.astro";
import Header from "../../../../components/Header.astro";

export const title = "The Part One of The First Lesson";

import { Content as content } from "./theory.md";
import { getBreadcrumbs } from "../../../../utils/getBreadcrumbs";
import { getNextPartUrl } from "../../../../utils/getNextPartUrl";

import type { LessonParent } from "../../../../types";

const getFile = async (name: string, ext: string) => {
  return {
    [`${name}.${ext}`]: (await import(`./code/_${name}.${ext}?raw`)).default,
  };
};

const fileNames = [
  { name: "index", ext: "js" },
  { name: "pass.test", ext: "js" },
];

const files = Object.assign(
  {},
  ...(await Promise.all(fileNames.map(({ name, ext }) => getFile(name, ext))))
);

const parent = (await Astro.glob("../index.astro"))[0] as LessonParent;

const { lessonParts } = parent;

const breadcrumbs = getBreadcrumbs(
  { url: parent.url, title: parent.title },
  title
);

const nextUrl = getNextPartUrl(lessonParts, Astro.url.pathname);
---

<TrainersLayout title={title}>
  <Header mode="editor" breadcrumbs={breadcrumbs} />
  <Editor
    files={files}
    template="vanilla"
    nextUrl={nextUrl}
    options={{ showConsole: true }}
  />
  <Theory Content={content} />
</TrainersLayout>
